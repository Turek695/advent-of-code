const dummy6_1: string = `....#.....
.........#
..........
..#.......
.......#..
..........
.#..^.....
........#.
#.........
......#...`;

const test6_1: string = `.....#..#................#...###..............................#..#.......................................#........................
..................#...........#.............#.#.#.#......................#.......##.........................................#.##.#
....#.......................................................#.......#.........................#...................................
.#.............#...........#..........................#.....................................................................#.....
....#..#................#..........................#..#..#...#..........#....................................#.#..................
...........................#....#.##......................................................................##...................#..
...........................#.....................................#....##.#..#..#.....#................#...........................
.....#..............#........#........................................###...........#..................................#..........
........#..............#............................................................#..............................#..............
......#..............................#..........................#................................................#................
................#..#......................#.......................................................................................
..#.............................##.....#.......................................................#..................................
#.......................................#...#.............................#...........#.#.........#.............#.................
..............................#................................#...#................................................#.............
..............#...............#.................#........................#...#.....#................#.............................
...................................#...#...........#...............#.........#............#...............##...........#.#........
.........................#..................................................................#.........#...........................
.##.............#................................#.......#.........#..............................................#...............
....#.................#.....#.......................................................#......................#......................
#..................................#................#......#.........................#............................................
.....#..................#................#........................................................................................
......#......#.......#......#.#....................#..................................#...................#...#...............#.#.
.................................................#......#......#.........#..................#.....................................
...........#.....#..................................#...#........#......#...#..................#.##....#.................#.......#
........#..#....................................#...................................................................#.......#.....
...........#..............#.............................................#..............#.#........#..##.................#.......#.
......................................#............................................#...#..........................................
.......#.............#............................#.........#................#.......................................#............
..........................................................................#.............#...............................#.........
......##...............#..........................................................................................#...............
.........#..#................................................#..................................#.......#.....................#...
...#..............................#.#.............#........................#..............#..............................#........
.......................................................................................................#.............#............
.....#.......................#..#..........#.....................................................................................#
..........##..........................#...............................#.......................#...............#.............#..#..
..#....#....................#.............#......#.............................................................#..................
.#....#..........................................................................................#.#......#.....................#.
..........................#.......#......................................................#........................................
.#......#.#......................................................................#........#.........#.........#.#.................
.....................................#........#..........#.............................#..#............#....................#.....
............#.........#.........................................................................................#........##.......
....................#.................#.........................#......................#......................................#...
............#....................................................#..#.........#..........#...................................#....
#.....#...................#.........#.#..................................................................................#........
.............................##.......#........................................#..........#..............#..#.....................
.............#....................................^.##....................................................#.....................#.
........................#.#..#......................#............#...#..........................#.......................#.........
......................#.......................................................................#.#..#......................#.......
..................................................#.......##...................................#..................................
.............................#..........................................#..............#.#.............................#..........
....#.............#..................#.....#..........................#....#..........#.........#........................#.......#
...............#...........................#...............#....................................................................#.
..........................#.............#..........................................................#..............................
...............#...................................#.......................#.............................#...............#........
....#......................##......#.#................................................#................#.............#............
.......#...................#..........................................#.....................................#.....................
.#.....................#..........................................................................................................
........#.#...........#....#...................................#..#.#....#..................#.#...............#......#........#...
#....#............#...#.........#...........#......................#.....................#........................................
........................#.............#.................................................................#.....#...................
...............#....................#................##...#...........#.#..............#..........................................
........................#...........##.......#.....#...........................#..#...................................#...........
.............#........................................................................#.....#.#.#.................##..............
......#......................#.........#..............#...............#................#..................#........#..............
..........#..........................................................................................................#............
..................#...........#................#..#.#..............#.#........#...............................#....#..........##..
...........#..............#...................................................#...................................................
..................................................................#............#............................#.................#...
....#...........#...................#..........................................#..........#...........................#...........
........................................#....................#....#..#........................#.....#.............................
................#........................................................................................................#........
...................#......#.....#..............#..................................#...#.............#........................#....
...................#............................................................#.............#...................................
.......#........................#..........#.............#....#....#.............#.............................#...#..............
...#...............##.............................................................#.................#........................#....
.............................#.................#..................#.#....................#.....................................###
...............#....#.....................................................#..............................................#.......#
....................................#..................................#.......................#..................................
#..#............#................................#....#...............#.........#...........................#.....................
...........................................................................................................#.............#....#..#
...................................#....#.........#..................#......#....................#..........#.....................
...........#.............................................................##.#......#.....#......................#...#.............
..#...................................................................................#.................#.........#...............
.......#..#..#.................................#.....................#..............................................#....#........
..........................#....................................................................................................#..
..#.............#......#..................................#..#.......................#..........#...#...##......#.................
....#...................#....#.........................................................#..................................#.......
.................................#...............#.....................#..#.......................................................
...........#......................................................................................................#...........#...
.............#.................................................................#............#..................#........#.........
.......................#.......#..........................................................#...............................#.....#.
...........................................................................#....#....#............................#...............
....................#............#................................................................................................
.....#.........................................#...................#.....#...#.......#..............#............................#
...#.......................................#.........#............#...................#......................#....#............##.
...##.#...........................................#...#................#..........................................................
.......#..##............#..#............#......................................#...............#...........#.........#......#..#..
...............................................................................#.........##........##.............#...............
......#...............................#.........#............#..............................#.........................#....#......
#...........................#....#..#....................................................#..................#.....................
......#.##.......#...........................#...#........#.................................................................#.....
..........#.................................................#..........................................#....#.#.........#.#.#.....
...#...#.....#......#.......#..#.#.........#...............................................................#..........##.........#
..#...#...#..........................................#............................#..........#..........#.........................
#....#............#......#.............#.#.......##...............#................#.............................#................
...............................#...............................................................#..............#.........#.........
....#..............#..#............................................................#.......#................#...................#.
....#...........................#.............................#.............#....#.........#....#...................#.......#.#...
.......#.......................................#....#........#..............#........#....................#.......................
........#...........................#................................#............................................................
...........#....#........#......................................#...........#.................................#..........#........
........#..........................................................................................#...........................#..
#........................................#.................................................................##...#.....#...........
............#..............#...........#............#................#..#.......................#.#.....#.............##..........
..........#..................#..................................................................................................#.
.....................................#..............##..................................#.............#........#..................
..............................#..................#...............#......#..##....................#................................
..#............#....................................#.......................................................#...#.................
..................###..........................#.......#.................................#........................................
.....#.#..........................................................#...........##...#.....#.................................#......
.............................................#.............................#......................#.............#.......#.....#...
...#......................#............#..................................#........................#....................#.......#.
....##..........#..........#...#.............#............#....#......#....................#...........#..#..........#............
..#......................#............#..#..#.......................#.........#......#...............#............#..#............
..#.............#.#.............................#......#......#.........................#......#.#...............#...............#
...#...........#...............#.....................................#.................#....#....#...................#.#...#......
.......#........#....................#.............................................#..............................................
........#............................#....#....#........#...................#.#...............#...#.....................#.........
.##........#.................#...........#...............................##.#.....................................................
.###...........................#........#..#................................................#...........................#.........`;

moveGuardian(test6_1)

function moveGuardian(input: string): void {
    const originalMap:string[][] = input.split('\n').map(row => row.split(''));
    interface Position {r: number, c: number}
    const startGuardPosition: Position = findGuardStart(originalMap);
    let guardPosition: Position = {...startGuardPosition};

    let direction: number = 0;

    const directions: Position[] = [
        {r: -1, c: 0},
        {r: 0, c: 1},
        {r: 1, c: 0},
        {r: 0, c: -1},
    ];

    const figure = [ '^', '>', 'v', '<'];
    let moveCounter: number = 0;
    let moveLimit: number = null;

    const basicMap:string[][] = originalMap.map(row => row.slice());
    do {} while (move(basicMap));

    moveLimit = moveCounter * 2 + 10;
    const potentialObstaclePlaces: Position[] = findPotentialObstaclePlaces(originalMap);
    let validObstaclePlaces: number = 0;

    potentialObstaclePlaces.forEach(potentialObstaclePlace => {
        moveCounter = 0;
        guardPosition = {...startGuardPosition};
        direction = 0;
        const newMap = originalMap.map(row => row.slice());
        newMap[potentialObstaclePlace.r][potentialObstaclePlace.c] = 'O';
        do {} while (move(newMap));
        if (moveCounter >= moveLimit) {
            validObstaclePlaces++;
        }
    })

    function move(map: string[][]): boolean {
        moveCounter++;
        if (moveLimit && (moveCounter >= moveLimit)) {
            return false;
        }
        const newPosition: Position = {r: guardPosition.r + directions[direction].r, c: guardPosition.c + directions[direction].c};

        const isOutOfMap: boolean = newPosition.r < 0 || newPosition.r >= map.length || newPosition.c < 0 || newPosition.c >= map[0].length;
        if (isOutOfMap) {
            map[guardPosition.r][guardPosition.c] = 'X';
            return false;
        }

        const mapNewPosition: string = map[newPosition.r][newPosition.c];
        if (['.', 'X'].includes(mapNewPosition)) {
            map[guardPosition.r][guardPosition.c] = 'X';
            map[newPosition.r][newPosition.c] = figure[direction];
            guardPosition.r = newPosition.r;
            guardPosition.c = newPosition.c;
            return true;
        } else if (['#', 'O'].includes(mapNewPosition)) {
            direction = (direction + 1) % 4;
            map[guardPosition.r][guardPosition.c] = figure[direction];
            return true;
        } else {
            return false;
        }
    }

    function findGuardStart(map: string[][]): Position {
        const start: Position = {r: 0, c: 0};
        start.r = map.findIndex((row: string[]): boolean => {
            const positionCIndex: number = row.findIndex((el: string) => el === '^');
            if (positionCIndex >= 0) {
                start.c = positionCIndex;
                return true;
            }
            return false;
        })

        return start;
    }

    function findPotentialObstaclePlaces(map: string[][]): Position[] {
        const potentialObstaclePlaces: Position[] = [];
        map.forEach((row: string[], r: number) => {
            row.forEach((el: string, c: number) => {
                if (el === '.') {
                    potentialObstaclePlaces.push({r, c});
                }
            })
        })
        return potentialObstaclePlaces;
    }
}
